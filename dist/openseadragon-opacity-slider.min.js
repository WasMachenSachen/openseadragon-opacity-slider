(function(m){typeof define=="function"&&define.amd?define(m):m()})(function(){"use strict";const m="OpenSeadragon Opacity Slider";(function(y){if(!y.version||y.version.major<3)throw new Error(`This version of ${m} requires OpenSeadragon version 3.0.0+`);y.Viewer.prototype.opacityslider=function(e){this.Instance||(e=e||{},e.viewer=this,window.options=e,this.opacitysliderInstance=new y.OpacitySlider(e))},y.OpacitySlider=function(e){if(!e.layerInformation||!Array.isArray(e.layerInformation))throw new Error(`${m} requires options.layerInformation`);e.layerInformation.forEach(r=>{r.hidden||(r.hidden=!1)}),e.layerPickerHeading=e.layerPickerHeading?e.layerPickerHeading:"Choose layers:";let t=document.createElement("div");t.id="opacitySliderWrapperContent",document.getElementById("opacitySliderWrapper").appendChild(t).classList.add("osdos-opacity-layer-slider-wrapper"),(e.showLayerPicker||e.showLayerPicker===void 0)&&v(e),e.viewer.world.addHandler("add-item",function(r){let d=r.item.source.tilesUrl?`${r.item.source.tilesUrl.slice(0,-7)}.dzi`:r.item.source.url,a=e.layerInformation.filter(l=>l.source===d);r.item.osdosHidden=a.length?a[0].hidden:!1,w(e)}),console.log("Plugin Initialized")};function v(e){const t=document.createElement("div");t.classList.add("osdos-layer-picker-wrapper"),t.style="background: white; display: none;",t.id="checkboxWrapperContent";let r=document.createElement("h2");r.textContent=e.layerPickerHeading,t.appendChild(r);let d=document.createElement("ul");e.layerInformation.forEach(a=>{let l=document.createElement("li"),s=e.showLayerInformation||e.showLayerInformation===void 0?`<p>${a.layerNameExplanation}</p>`:"";l.innerHTML=`
        <input data-osdos='visibility-checkbox' type="checkbox" name="${a.layerName}" id="${a.layerName}" ${a.hidden?"":"checked"} data-osdos-source="${a.source}"/>
        <label for="${a.layerName}">${a.layerName}</label>
        ${s}
      `,d.appendChild(l)}),t.appendChild(d),document.querySelector("#opacitySliderWrapper").prepend(t),document.querySelectorAll("[data-osdos='visibility-checkbox']").forEach(a=>{a.addEventListener("click",l=>{L(l,e)})})}function w(e){let t=I(e),r=document.getElementById("opacitySliderWrapperContent");if(r.innerHTML="",t.forEach((d,a)=>{const l=document.createElement("div");if(l.className="osdos-layer-slider",l.setAttribute("data-osd-index",a),e.showRemove||e.showRemove===void 0){let i=document.createElement("button");i.setAttribute("data-osdos","remove-button"),i.classList.add("osdos-layer-slider-remove-button"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" class="osdos-layer-slider-remove-button-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',i.addEventListener("click",()=>g(d.source,e)),l.appendChild(i)}if(e.sortable||e.sortable===void 0){const i=document.createElement("div");i.className="osdos-position-controls-wrapper";let n=document.createElement("button");n.setAttribute("data-osdos","up-button"),n.classList.add("osdos-layer-slider-up-button"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" class="osdos-layer-slider-up-button-icon" ><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>',n.addEventListener("click",()=>p(d.source,e)),i.appendChild(n);let o=document.createElement("button");o.setAttribute("data-osdos","down-button"),o.classList.add("osdos-layer-slider-down-button"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" class="osdos-layer-slider-down-button-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>',o.addEventListener("click",()=>h(d.source,e)),i.appendChild(o),l.appendChild(i)}let s=document.createElement("span");s.innerHTML=d.layerName,s.classList.add("osodos-layer-name-wrapper"),l.appendChild(s);let u=document.createElement("div");if(u.classList.add("osodos-opacity-controls-wrapper"),e.showRangeSlider||e.showRangeSlider===void 0){let i=document.createElement("input");const n={"data-osdos":"layer-opacity-slider",type:"range",min:"0",max:"100",name:"opacity-slider",class:"osdos-layer-slider-range-input"};Object.keys(n).forEach(o=>{i.setAttribute(o,n[o])}),u.appendChild(i)}if(e.showNumberInput||e.showNumberInput===void 0){let i=document.createElement("input");const n={"data-osdos":"layer-opacity-slider-value",type:"number",min:"0",max:"100",name:"opacity-slider-value",class:"osdos-layer-slider-number-input"};Object.keys(n).forEach(o=>{i.setAttribute(o,n[o])}),u.appendChild(i)}l.appendChild(u);let b=c(d.source,e);e.viewer.world.getItemAt(b).osdosHidden&&(l.style="display: none;",f(b,0,e)),r.appendChild(l)}),document.querySelector("#opacitySliderWrapper").appendChild(r),document.querySelectorAll("[data-osdos='layer-opacity-slider']").forEach((d,a)=>{d.setAttribute("data-osd-index",a),["change","input"].forEach(l=>{d.addEventListener(l,s=>{f(a,s.target.value/100,e),(e.showNumberInput||e.showNumberInput===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider-value'][data-osd-index='${a}']`).value=s.target.value)})})}),document.querySelectorAll("[data-osdos='layer-opacity-slider-value']").forEach((d,a)=>{d.setAttribute("data-osd-index",a),d.addEventListener("input",l=>{f(a,l.target.value/100,e),(e.showRangeSlider||e.showRangeSlider===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider'][data-osd-index='${a}']`).value=l.target.value)})}),t.forEach((d,a)=>{let l=e.viewer.world.getItemAt(a).getOpacity();(e.showNumberInput||e.showNumberInput===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider-value'][data-osd-index='${a}']`).value=l*100),(e.showRangeSlider||e.showRangeSlider===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider'][data-osd-index='${a}']`).value=l*100)}),e.showLayerPicker||e.showLayerPicker===void 0){const d=document.createElement("button");d.innerHTML=e.layerPickerButtonText||"Layer Picker",d.addEventListener("click",k),r.appendChild(d)}S(e.viewer)}function k(){let e=document.getElementById("checkboxWrapperContent");e.style.display=e.style.display==="block"?"none":"block"}function I(e){let t=e.viewer.world.getItemCount(),r=[];for(let d=0;d<t;d++){let a=e.viewer.world.getItemAt(d),l=a.source.tilesUrl?`${a.source.tilesUrl.slice(0,-7)}.dzi`:a.source.url,s=e.layerInformation.filter(u=>u.source===l);r[d]=s[0]}return r}function c(e,t){let r=t.viewer.world.getItemCount();for(let d=0;d<r;d++){let a=t.viewer.world.getItemAt(d),l=a.source.tilesUrl?`${a.source.tilesUrl.slice(0,-7)}.dzi`:a.source.url;if(e===l)return d}return-1}function f(e,t,r){r.viewer.world.getItemAt(e).setOpacity(t)}function h(e,t){let r=c(e,t);r!==0&&(t.viewer.world.setItemIndex(t.viewer.world.getItemAt(r),r-1),w(t),t.viewer.world.getItemAt(r).osdosHidden&&h(e,t))}function p(e,t){let r=c(e,t);t.viewer.world.getItemCount()>r+1&&(t.viewer.world.setItemIndex(t.viewer.world.getItemAt(r),r+1),w(t),t.viewer.world.getItemAt(r).osdosHidden&&p(e,t))}function g(e,t){let r=c(e,t);f(r,0,t),t.viewer.world.getItemAt(r).osdosHidden=!0,w(t),(t.showLayerPicker||t.showLayerPicker===void 0)&&(document.querySelector(`[data-osdos-source="${e}"]`).checked=!1)}function E(e,t){let r=c(e,t);f(r,1,t),t.viewer.world.getItemAt(r).osdosHidden=!1,w(t),document.querySelector(`[data-osdos-source="${e}"]`).checked=!0}function L(e,t){let r=c(e.target.getAttribute("data-osdos-source"),t);e.target.checked&&r!=-1?E(e.target.getAttribute("data-osdos-source"),t):!e.target.checked&&r!=-1&&g(e.target.getAttribute("data-osdos-source"),t)}function S(e){document.querySelectorAll(".opacity-slider-disabled").forEach(d=>{d.classList.remove("osdos-curser-not-allowed"),d.disabled=!1});let t=document.querySelector("[data-osd-index='0'] [data-osdos='down-button']");t!==null&&(t.classList.add("osdos-curser-not-allowed"),t.disabled=!0);let r=document.querySelector(`[data-osd-index='${e.world.getItemCount()-1}'] [data-osdos='up-button']`);r!==null&&(r.classList.add("osdos-curser-not-allowed"),r.disabled=!0)}})(OpenSeadragon)});
