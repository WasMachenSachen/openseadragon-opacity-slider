(function(c){typeof define=="function"&&define.amd?define(c):c()})(function(){"use strict";const c="OpenSeadragon Opacity Slider";(function(m){if(!m.version||m.version.major<3)throw new Error(`This version of ${c} requires OpenSeadragon version 3.0.0+`);m.Viewer.prototype.opacityslider=function(e){this.Instance||(e=e||{},e.viewer=this,this.opacitysliderInstance=new m.OpacitySlider(e))},m.OpacitySlider=function(e){if(!e.layerInformation||!Array.isArray(e.layerInformation))throw new Error(`${c} requires options.layerInformation`);if(!document.getElementById("opacitySliderWrapper"))throw new Error(`${c} requires a div with an id of 'opacitySliderWrapper'`);e.layerInformation.forEach(r=>{r.hidden||(r.hidden=!1)}),e.layerPickerHeading=e.layerPickerHeading?e.layerPickerHeading:"Choose layers:";let t=document.createElement("div");t.id="opacitySliderWrapperContent",document.getElementById("opacitySliderWrapper").appendChild(t).classList.add("osdos-opacity-layer-slider-wrapper"),(e.showLayerPicker||e.showLayerPicker===void 0)&&k(e),e.viewer.world.addHandler("add-item",function(r){let d=r.item.source.tilesUrl?`${r.item.source.tilesUrl.slice(0,-7)}.dzi`:r.item.source.url,a=e.layerInformation.filter(l=>l.source===d);r.item.osdosHidden=a.length?a[0].hidden:!1,y(e)}),console.log("Plugin Initialized")};function k(e){const t=document.createElement("div");t.classList.add("osdos-layer-picker-wrapper"),t.style="display: none;",t.id="checkboxWrapperContent";let r=document.createElement("h2");r.textContent=e.layerPickerHeading,t.appendChild(r);let d=document.createElement("ul");e.layerInformation.forEach(a=>{let l=document.createElement("li"),n=e.showLayerInformation||e.showLayerInformation===void 0?`<p>${a.layerNameExplanation}</p>`:"";l.innerHTML=`
        <input data-osdos='visibility-checkbox' type="checkbox" name="${a.layerName}" id="${a.layerName}" ${a.hidden?"":"checked"} data-osdos-source="${a.source}"/>
        <label for="${a.layerName}">${a.layerName}</label>
        ${n}
      `,d.appendChild(l)}),t.appendChild(d),document.querySelector("#opacitySliderWrapper").prepend(t),document.querySelectorAll("[data-osdos='visibility-checkbox']").forEach(a=>{a.addEventListener("click",l=>{S(l,e)})})}function y(e){let t=E(e),r=document.getElementById("opacitySliderWrapperContent");if(r.innerHTML="",t.forEach((d,a)=>{const l=document.createElement("div");l.className="osdos-layer-slider",l.setAttribute("data-osd-index",a);const n=document.createElement("div");if(n.className="osdos-layer-controls-wrapper",e.showRemove||e.showRemove===void 0){let i=document.createElement("button");i.setAttribute("data-osdos","remove-button"),i.classList.add("osdos-layer-slider-remove-button"),i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" class="osdos-layer-slider-remove-button-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',i.addEventListener("click",()=>b(d.source,e)),n.appendChild(i)}if(e.sortable||e.sortable===void 0){const i=document.createElement("div");i.className="osdos-position-controls-wrapper";let o=document.createElement("button");o.setAttribute("data-osdos","up-button"),o.classList.add("osdos-layer-slider-up-button"),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" class="osdos-layer-slider-up-button-icon" ><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>',o.addEventListener("click",()=>g(d.source,e)),i.appendChild(o);let s=document.createElement("button");s.setAttribute("data-osdos","down-button"),s.classList.add("osdos-layer-slider-down-button"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" class="osdos-layer-slider-down-button-icon"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>',s.addEventListener("click",()=>h(d.source,e)),i.appendChild(s),n.appendChild(i)}let w=document.createElement("span");w.innerHTML=d.layerName,w.classList.add("osodos-layer-name-wrapper"),n.appendChild(w);let p=document.createElement("div");if(p.classList.add("osodos-opacity-controls-wrapper"),l.appendChild(n),e.showRangeSlider||e.showRangeSlider===void 0){let i=document.createElement("input");const o={"data-osdos":"layer-opacity-slider",type:"range",min:"0",max:"100",name:"opacity-slider",class:"osdos-layer-slider-range-input"};Object.keys(o).forEach(s=>{i.setAttribute(s,o[s])}),p.appendChild(i)}if(e.showNumberInput||e.showNumberInput===void 0){let i=document.createElement("input");const o={"data-osdos":"layer-opacity-slider-value",type:"number",min:"0",max:"100",name:"opacity-slider-value",class:"osdos-layer-slider-number-input"};Object.keys(o).forEach(s=>{i.setAttribute(s,o[s])}),p.appendChild(i)}l.appendChild(p);let v=u(d.source,e);e.viewer.world.getItemAt(v).osdosHidden&&(l.style="display: none;",f(v,0,e)),r.appendChild(l)}),document.querySelector("#opacitySliderWrapper").appendChild(r),document.querySelectorAll("[data-osdos='layer-opacity-slider']").forEach((d,a)=>{d.setAttribute("data-osd-index",a),["change","input"].forEach(l=>{d.addEventListener(l,n=>{f(a,n.target.value/100,e),(e.showNumberInput||e.showNumberInput===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider-value'][data-osd-index='${a}']`).value=n.target.value)})})}),document.querySelectorAll("[data-osdos='layer-opacity-slider-value']").forEach((d,a)=>{d.setAttribute("data-osd-index",a),d.addEventListener("input",l=>{f(a,l.target.value/100,e),(e.showRangeSlider||e.showRangeSlider===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider'][data-osd-index='${a}']`).value=l.target.value)})}),t.forEach((d,a)=>{let l=e.viewer.world.getItemAt(a).getOpacity();(e.showNumberInput||e.showNumberInput===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider-value'][data-osd-index='${a}']`).value=l*100),(e.showRangeSlider||e.showRangeSlider===void 0)&&(document.querySelector(`[data-osdos='layer-opacity-slider'][data-osd-index='${a}']`).value=l*100)}),e.showLayerPicker||e.showLayerPicker===void 0){const d=document.createElement("button");d.className="osdos-layer-picker-button",d.innerHTML=e.layerPickerButtonText||"Layer Picker",d.addEventListener("click",I),r.appendChild(d)}x(e)}function I(){let e=document.getElementById("checkboxWrapperContent");e.style.display=e.style.display==="block"?"none":"block"}function E(e){let t=e.viewer.world.getItemCount(),r=[];for(let d=0;d<t;d++){let a=e.viewer.world.getItemAt(d),l=a.source.tilesUrl?`${a.source.tilesUrl.slice(0,-7)}.dzi`:a.source.url,n=e.layerInformation.filter(w=>w.source===l);r[d]=n[0]}return r}function u(e,t){let r=t.viewer.world.getItemCount();for(let d=0;d<r;d++){let a=t.viewer.world.getItemAt(d),l=a.source.tilesUrl?`${a.source.tilesUrl.slice(0,-7)}.dzi`:a.source.url;if(e===l)return d}return-1}function f(e,t,r){r.viewer.world.getItemAt(e).setOpacity(t)}function h(e,t){let r=u(e,t);r!==0&&(t.viewer.world.setItemIndex(t.viewer.world.getItemAt(r),r-1),y(t),t.viewer.world.getItemAt(r).osdosHidden&&h(e,t))}function g(e,t){let r=u(e,t);t.viewer.world.getItemCount()>r+1&&(t.viewer.world.setItemIndex(t.viewer.world.getItemAt(r),r+1),y(t),t.viewer.world.getItemAt(r).osdosHidden&&g(e,t))}function b(e,t){let r=u(e,t);f(r,0,t),t.viewer.world.getItemAt(r).osdosHidden=!0,y(t),(t.showLayerPicker||t.showLayerPicker===void 0)&&(document.querySelector(`[data-osdos-source="${e}"]`).checked=!1)}function L(e,t){let r=u(e,t);f(r,1,t),t.viewer.world.getItemAt(r).osdosHidden=!1,y(t),document.querySelector(`[data-osdos-source="${e}"]`).checked=!0}function S(e,t){let r=u(e.target.getAttribute("data-osdos-source"),t);e.target.checked&&r!=-1?L(e.target.getAttribute("data-osdos-source"),t):!e.target.checked&&r!=-1&&b(e.target.getAttribute("data-osdos-source"),t)}function x(e){document.querySelectorAll(".opacity-slider-disabled").forEach(d=>{d.classList.remove("osdos-curser-not-allowed"),d.disabled=!1});let t=document.querySelector("[data-osd-index='0'] [data-osdos='down-button']");t!==null&&(t.classList.add("osdos-curser-not-allowed"),t.disabled=!0);let r=document.querySelector(`[data-osd-index='${e.viewer.world.getItemCount()-1}'] [data-osdos='up-button']`);r!==null&&(r.classList.add("osdos-curser-not-allowed"),r.disabled=!0)}})(OpenSeadragon)});
